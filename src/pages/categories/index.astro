---
import { getCollection } from "astro:content";
import BaseHead from "../../components/BaseHead.astro";
import Footer from "../../components/Footer.astro";
import Header from "../../components/Header.astro";
import { SITE_DESCRIPTION, SITE_TITLE } from "../../consts";

const allPosts = await getCollection("pages");

const tagMap = new Map();
allPosts.forEach((post) => {
  post.data.categories.forEach((category) => {
    if (tagMap.has(category)) {
      const currVal = tagMap.get(category);
      tagMap.set(category, currVal + 1);
    } else {
      tagMap.set(category, 1);
    }
  });
});
---

<!doctype html>
<html lang="en">
  <head>
    <BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
  </head>
  <body>
    <Header />
    <main>
      <h1 class="mb-4 text-center capitalize">Categories</h1>

      <div class="mx-4 grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3">
        {
          tagMap.entries().map(([tag, count]) => {
            return (
              <div class="bg-surface-0 flex cursor-pointer items-center justify-between rounded p-4" data-location={`/categories/${tag}`}>
                <h2 class="link capitalize underline">{tag}</h2>
                <div class="text-peach">{count} Pages</div>
              </div>
            );
          })
        }
      </div>
    </main>
    <Footer />
  </body>
</html>
